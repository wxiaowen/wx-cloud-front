(function(e){function t(t){for(var o,s,r=t[0],c=t[1],u=t[2],p=0,d=[];p<r.length;p++)s=r[p],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);l&&l(t);while(d.length)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},i={app:0},a=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var u=0;u<r.length;u++)t(r[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("keep-alive",{attrs:{include:"chat,nav"}},[n("transition",{attrs:{name:"fade",mode:"out-in"}},[n("router-view",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:e.$route.meta.title,expression:"$route.meta.title"}]})],1)],1)],1)},a=[],s={name:"App"},r=s,c=(n("034f"),n("2877")),u=Object(c["a"])(r,i,a,!1,null,null,null),l=u.exports,p=n("8c4f"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-app",[n("v-app-bar",{attrs:{app:"",dense:""}},[n("v-toolbar-title",[e._v(" "+e._s(e.uuid))])],1),n("v-main",[e.noticeBarMessage?n("van-notice-bar",{attrs:{"left-icon":"volume-o",wrapable:"",scrollable:!0,text:e.noticeBarMessage}}):e._e(),n("v-container",{attrs:{fluid:""}},[n("v-list",{attrs:{"two-line":""}},[n("v-list-item-group",{attrs:{multiple:"",id:"message-list"}},[e._l(e.messageList,(function(t,o){return[n("v-divider"),n("v-list-item",{key:t.id},[[n("v-list-item-content",[n("v-list-item-title",{domProps:{textContent:e._s(t.from)}}),n("v-list-item-subtitle",{staticClass:"text--primary",domProps:{textContent:e._s(t.content)}})],1)]],2),n("v-divider")]}))],2)],1)],1)],1),n("v-footer",{ref:"button",attrs:{app:""}},[n("v-container",[n("v-row",[n("v-col",[n("v-textarea",{attrs:{label:" ",rows:"2"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}},[n("template",{slot:"append-outer"},[n("v-icon",{attrs:{color:"blue","x-large":""},on:{click:e.sendMessage}},[e._v("mdi-send")])],1)],2)],1)],1)],1)],1)],1)],1)},f=[],m=n("ade3"),v=(n("b0c0"),n("e9c4"),n("74d1")),b=n.n(v),h=n("cc7d"),g=n.n(h),y=n("323e"),w=n.n(y),C=(n("a5d8"),n("f564"));w.a.configure({showSpinner:!1});var O={name:"Chat",components:Object(m["a"])({},C["a"].Component.name,C["a"].Component),data:function(){return{websocket:void 0,content:"",wsUrl:"/ws/connect",stompClient:void 0,uuid:void 0,clientId:void 0,chatTopic:"/many-chat",messageList:[],noticeBarMessage:""}},mounted:function(){this.uuid=this.$uuid.v1(),this.clientId=this.$uuid.v1(),this.initWebSocket()},created:function(){},beforeDestroy:function(){this.disconnect()},methods:{initWebSocket:function(){var e=this;w.a.start();var t=new g.a(e.wsUrl);e.stompClient=b.a.over(t),e.stompClient.heartbeat.outgoing=5e3,e.stompClient.heartbeat.incoming=0;var n={uuid:e.uuid,clientId:e.clientId};e.stompClient.connect(n,(function(t){e.successCallBack(t)}),(function(t){e.failCallBack(t)})),console.log(e.stompClient)},message:function(e){var t=JSON.parse(e.data);console.log(t)},successCallBack:function(){var e=this;w.a.done(),Object(C["a"])({message:"连接成功",type:"success"}),e.stompClient.subscribe("/topic"+e.chatTopic,(function(t){if(t&&t.body){var n=JSON.parse(t.body);console.log("message "+n),e.messageList.push(n),e.$vuetify.goTo(e.$refs.button,{}),t.ack()}}),{uuid:e.uuid,ack:"client"}),e.stompClient.subscribe("/app/online",(function(e){e.ack()}),{uuid:e.uuid,ack:"client"}),e.stompClient.subscribe("/topic/online",(function(t){if(t&&t.body){var n=JSON.parse(t.body);console.log("message "+n);var o=n.from;o!==e.uuid&&(e.noticeBarMessage=n.from,setTimeout((function(){e.noticeBarMessage=""}),5e3)),t.ack()}}),{uuid:e.uuid,ack:"client"})},failCallBack:function(e){console.error(e),w.a.done(),Object(C["a"])({message:"连接失败",type:"error"})},sendMessage:function(){var e=this;if(e.content){if(e.stompClient&&e.stompClient.connected){var t=e.stompClient.begin(),n={transaction:t.id,uuid:e.uuid};e.stompClient.send("/app"+e.chatTopic,Object.assign({},n,{}),JSON.stringify({content:e.content,from:e.uuid})),t.commit(),e.content=""}}else Object(C["a"])({type:"warning",message:"你不写点啥。。。。"})},disconnect:function(){var e=this;e.stompClient&&e.stompClient.connected&&e.stompClient.disconnect()}}},k=O,x=Object(c["a"])(k,d,f,!1,null,"0a487fe8",null),_=x.exports;o["default"].use(p["a"]);var j=[{path:"/",name:"Chat",component:_,meta:{title:"chat",keepAlive:!1}}],S=new p["a"]({mode:"history",base:"",routes:j}),M=S,$=n("2f62");o["default"].use($["a"]);var B=new $["a"].Store({state:{},mutations:{},actions:{},modules:{}}),P=n("ce5b"),T=n.n(P),J=(n("bf40"),n("5363"),n("1f25")),N=n.n(J),I=n("21eb"),A=n.n(I);o["default"].use(T.a);var L=new N.a({max:10,maxAge:36e5}),E={icons:{iconfont:"mdi"},theme:{options:{minifyTheme:A.a},themeCache:L}},U=new T.a(E),W=n("7876"),D=n.n(W),q=n("9612"),z=n("b970");n("157a");o["default"].use(D.a),o["default"].config.productionTip=!1,o["default"].use(D.a),o["default"].use(z["a"]),o["default"].prototype.$uuid=q["a"],new o["default"]({vuetify:U,router:M,store:B,render:function(e){return e(l)}}).$mount("#app")},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.d385cf2f.js.map